---
import { getCollection } from 'astro:content';
import '../../styles/global.css';
import Navbar from '../../components/Navbar.tsx';
import { TagList } from '../../components/Tag.tsx';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog', ({ data }) => {
    return data.draft !== true;
  });
  
  return blogEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={entry.data.description} />
    <title>{entry.data.title} | CyberSec Portfolio</title>
    <script is:inline>
      (function() {
        const theme = localStorage.getItem('theme') || 'system';
        const root = document.documentElement;
        if (theme === 'system') {
          const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          root.classList.add(systemDark ? 'dark' : 'light');
        } else {
          root.classList.add(theme);
        }
      })();
    </script>
  </head>

  <body class="bg-background text-foreground min-h-screen">
    <Navbar client:load />
    
    <main class="pt-24 px-4 max-w-4xl mx-auto pb-16">
      <article>
        <header class="mb-8">
          <a href="/blog" class="text-muted-foreground hover:text-foreground transition mb-4 inline-block">
            ‚Üê Back to Blog
          </a>
          <h1 class="text-4xl md:text-5xl font-bold mb-4">{entry.data.title}</h1>
          <div class="flex items-center gap-4 text-muted-foreground">
            <time datetime={entry.data.pubDate.toISOString()}>
              {entry.data.pubDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}
            </time>
          </div>
          {entry.data.tags && entry.data.tags.length > 0 && (
            <TagList tags={entry.data.tags} className="mt-4" />
          )}
        </header>
        
        <div class="prose max-w-none">
          <Content />
        </div>
      </article>
    </main>
  </body>
</html>
